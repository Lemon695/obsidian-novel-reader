# ğŸ“Š é˜…è¯»ç»Ÿè®¡ç³»ç»Ÿå‡çº§ - ä¼ä¸šçº§æŠ€æœ¯è®¾è®¡æ–‡æ¡£

> **ç‰ˆæœ¬**: 2.0.0
> **åˆ›å»ºæ—¥æœŸ**: 2024-01-16
> **çŠ¶æ€**: å®æ–½ä¸­
> **è´Ÿè´£äºº**: Claude AI

---

## ğŸ“‘ ç›®å½•

1. [é¡¹ç›®èƒŒæ™¯](#é¡¹ç›®èƒŒæ™¯)
2. [ç°çŠ¶åˆ†æ](#ç°çŠ¶åˆ†æ)
3. [æŠ€æœ¯æ–¹æ¡ˆ](#æŠ€æœ¯æ–¹æ¡ˆ)
4. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
5. [æ•°æ®æ¨¡å‹](#æ•°æ®æ¨¡å‹)
6. [å®æ–½è®¡åˆ’](#å®æ–½è®¡åˆ’)
7. [é£é™©è¯„ä¼°](#é£é™©è¯„ä¼°)
8. [æµ‹è¯•è®¡åˆ’](#æµ‹è¯•è®¡åˆ’)
9. [å›æ»šæ–¹æ¡ˆ](#å›æ»šæ–¹æ¡ˆ)

---

## é¡¹ç›®èƒŒæ™¯

### é—®é¢˜ç°çŠ¶

å½“å‰ç»Ÿè®¡ç³»ç»Ÿä½¿ç”¨ **å•ä¸ª Loki æ•°æ®åº“æ–‡ä»¶** (`reading-stats.json`) å­˜å‚¨æ‰€æœ‰æ•°æ®ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

| é—®é¢˜ç±»å‹ | ä¸¥é‡ç¨‹åº¦ | å½±å“ |
|---------|----------|------|
| **å•ç‚¹æ•…éšœ** | ğŸ”´ ä¸¥é‡ | JSONæŸåå¯¼è‡´å…¨éƒ¨æ•°æ®ä¸¢å¤± |
| **æ€§èƒ½ç“¶é¢ˆ** | ğŸŸ¡ ä¸­ç­‰ | 100+æœ¬ä¹¦ååŠ è½½å˜æ…¢ |
| **å¹¶å‘å†²çª** | ğŸŸ¡ ä¸­ç­‰ | å¤šè§†å›¾å†™å…¥å¯èƒ½è¦†ç›– |
| **å¤‡ä»½å›°éš¾** | ğŸŸ  è¾ƒä½ | å•æ–‡ä»¶éš¾ä»¥å¢é‡å¤‡ä»½ |
| **åŠŸèƒ½å—é™** | ğŸŸ¡ ä¸­ç­‰ | ç¼ºå°‘ä¼ä¸šçº§ç»Ÿè®¡ç»´åº¦ |

### å‡çº§ç›®æ ‡

1. âœ… **æ•°æ®å®‰å…¨**: åˆ†æ•£å­˜å‚¨ï¼Œé™ä½å•ç‚¹æ•…éšœé£é™©
2. âœ… **æ€§èƒ½ä¼˜åŒ–**: æŒ‰éœ€åŠ è½½ï¼Œæ”¯æŒ100+æœ¬ä¹¦
3. âœ… **åŠŸèƒ½å¢å¼º**: ä¼ä¸šçº§ç»Ÿè®¡åˆ†æ
4. âœ… **å‘åå…¼å®¹**: ä¸å½±å“ç°æœ‰åŠŸèƒ½
5. âœ… **å¹³æ»‘è¿ç§»**: ç”¨æˆ·æ— æ„ŸçŸ¥å‡çº§

---

## ç°çŠ¶åˆ†æ

### å½“å‰æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    DatabaseService (Loki)           â”‚
â”‚    - reading_sessions collection    â”‚
â”‚    - novel_stats collection         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    reading-stats.json (å•æ–‡ä»¶)
    â”œâ”€ sessions: [...]  (~10KB/book)
    â””â”€ stats: [...]     (~5KB/book)
```

**é—®é¢˜ï¼š**
- 100æœ¬ä¹¦ â‰ˆ 1.5MB å•æ–‡ä»¶
- æ¯æ¬¡è¯»å†™å…¨é‡åŠ è½½
- JSONè§£æé”™è¯¯å¯¼è‡´å…¨éƒ¨ä¸¢å¤±

### å½“å‰æ•°æ®å­—æ®µï¼ˆv1.0ï¼‰

```typescript
interface NovelReadingStats {
    novelId: string;
    stats: {
        totalReadingTime: number;        // âœ… åŸºç¡€
        sessionsCount: number;            // âœ… åŸºç¡€
        firstReadTime: number;            // âœ… åŸºç¡€
        lastReadTime: number;             // âœ… åŸºç¡€
        averageSessionTime: number;       // âœ… åŸºç¡€
        dailyStats: {...};                // âœ… åŸºç¡€
        chapterStats: {...};              // âœ… åŸºç¡€

        // âŒ ç¼ºå¤±ï¼š
        // - é˜…è¯»é€Ÿåº¦æ›²çº¿
        // - è·³è¯»æ£€æµ‹
        // - è¿›åº¦å†å²
        // - æ—¶é—´æ®µåˆ†æ
        // - æˆå°±ç³»ç»Ÿ
    };
}
```

---

## æŠ€æœ¯æ–¹æ¡ˆ

### æ–¹æ¡ˆå¯¹æ¯”

#### æ–¹æ¡ˆAï¼šå¤šæ–‡ä»¶JSONï¼ˆæ¨èï¼‰âœ…

**ç›®å½•ç»“æ„ï¼š**
```
.obsidian/plugins/novel-reader/stats/
â”œâ”€â”€ index.json                    # å…¨å±€ç´¢å¼• (~10KB)
â”œâ”€â”€ global.json                   # å…¨å±€ç»Ÿè®¡ (~20KB)
â”œâ”€â”€ novels/
â”‚   â”œâ”€â”€ {novelId-1}/
â”‚   â”‚   â”œâ”€â”€ stats.json           # è¯¥ä¹¦ç»Ÿè®¡ (~15KB)
â”‚   â”‚   â”œâ”€â”€ sessions-2024-01.json # 1æœˆä¼šè¯ (~8KB)
â”‚   â”‚   â”œâ”€â”€ sessions-2024-02.json # 2æœˆä¼šè¯ (~8KB)
â”‚   â”‚   â””â”€â”€ daily-stats.json     # æ¯æ—¥èšåˆ (~5KB)
â”‚   â””â”€â”€ {novelId-2}/
â”‚       â””â”€â”€ ...
â”œâ”€â”€ backups/
â”‚   â”œâ”€â”€ daily/                   # æ¯æ—¥è‡ªåŠ¨å¤‡ä»½
â”‚   â””â”€â”€ manual/                  # æ‰‹åŠ¨å¤‡ä»½
â””â”€â”€ migrations/
    â””â”€â”€ migration-{timestamp}.json # è¿ç§»è®°å½•
```

**ä¼˜åŠ¿ï¼š**
- âœ… åˆ†æ•£é£é™©ï¼šå•æœ¬ä¹¦æŸåä¸å½±å“å…¶ä»–
- âœ… æŒ‰éœ€åŠ è½½ï¼šåªåŠ è½½å½“å‰éœ€è¦çš„æ•°æ®
- âœ… å¢é‡å¤‡ä»½ï¼šåªå¤‡ä»½ä¿®æ”¹çš„æ–‡ä»¶
- âœ… äººç±»å¯è¯»ï¼šJSONæ˜“äºè°ƒè¯•
- âœ… è·¨å¹³å°ï¼šæ— nativeä¾èµ–
- âœ… æ˜“æ‰©å±•ï¼šæ·»åŠ æ–°ç»Ÿè®¡å­—æ®µæ–¹ä¾¿

**åŠ£åŠ¿ï¼š**
- âš ï¸ æ–‡ä»¶æ•°å¢åŠ ï¼š100æœ¬ä¹¦ â‰ˆ 400ä¸ªæ–‡ä»¶
- âš ï¸ éœ€è¦ç´¢å¼•ç®¡ç†

#### æ–¹æ¡ˆBï¼šSQLite + better-sqlite3

**ä¼˜åŠ¿ï¼š**
- âœ… å¼ºå¤§çš„æŸ¥è¯¢èƒ½åŠ›
- âœ… æ•°æ®å®Œæ•´æ€§çº¦æŸ
- âœ… é«˜æ€§èƒ½ç´¢å¼•

**åŠ£åŠ¿ï¼š**
- âŒ éœ€è¦ç¼–è¯‘nativeæ¨¡å—
- âŒ Obsidianç§»åŠ¨ç«¯å¯èƒ½ä¸æ”¯æŒ
- âŒ å¢åŠ æ’ä»¶ä½“ç§¯ ~500KB
- âŒ å¤‡ä»½å¤æ‚

**ç»“è®ºï¼š** âŒ ä¸æ¨è

#### æ–¹æ¡ˆCï¼šIndexedDB

**ä¼˜åŠ¿ï¼š**
- âœ… æµè§ˆå™¨åŸç”Ÿæ”¯æŒ
- âœ… å¼‚æ­¥æ“ä½œ
- âœ… é«˜æ€§èƒ½

**åŠ£åŠ¿ï¼š**
- âŒ ä»…æ”¯æŒæµè§ˆå™¨ç¯å¢ƒ
- âŒ ä¸æ”¯æŒæ¡Œé¢ç«¯Vaultè®¿é—®
- âŒ æ— æ³•è·¨vaultå…±äº«

**ç»“è®ºï¼š** âŒ ä¸æ¨è

---

## æ¶æ„è®¾è®¡

### æ–°æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        StatsStorageAdapter               â”‚
â”‚   (ç»Ÿä¸€æ¥å£ / å‘åå…¼å®¹å±‚)                 â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                    â”‚
      â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DatabaseService  â”‚   â”‚ MultiFileStatsStorage â”‚
â”‚ (Loki - æ—§ç³»ç»Ÿ)â”‚   â”‚ (æ–°ç³»ç»Ÿ - æ¨è)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                    â”‚
      â–¼                    â–¼
reading-stats.json    novels/{id}/stats.json
(å…¼å®¹ä¿ç•™)            (æ–°æ•°æ®ç›®å½•)
```

### æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | èŒè´£ | æ–‡ä»¶ |
|------|------|------|
| **EnhancedNovelStats** | å¢å¼ºæ•°æ®ç±»å‹ | `types/enhanced-stats.ts` |
| **StatsPathsManager** | æ–‡ä»¶è·¯å¾„ç®¡ç† | `utils/stats-paths.ts` |
| **StatsValidator** | æ•°æ®æ ¡éªŒ/ä¿®å¤ | `utils/stats-validator.ts` |
| **MultiFileStatsStorage** | å¤šæ–‡ä»¶å­˜å‚¨æœåŠ¡ | `services/multi-file-stats-storage.ts` |
| **StatsStorageAdapter** | å…¼å®¹é€‚é…å™¨ | `services/stats-adapter.ts` |
| **StatsMigrationService** | æ•°æ®è¿ç§»å·¥å…· | `services/stats-migration.ts` |

---

## æ•°æ®æ¨¡å‹

### å¢å¼ºçš„ç»Ÿè®¡å­—æ®µï¼ˆv2.0ï¼‰

#### 1. åŸºç¡€ç»Ÿè®¡ï¼ˆå…¼å®¹v1.0ï¼‰
```typescript
basicStats: {
    totalReadingTime: number;        // âœ… ä¿ç•™
    sessionsCount: number;            // âœ… ä¿ç•™
    firstReadTime: number;            // âœ… ä¿ç•™
    lastReadTime: number;             // âœ… ä¿ç•™
    lastUpdateTime: number;           // âœ¨ æ–°å¢
    dataChecksum: string;             // âœ¨ æ–°å¢ - æ•°æ®å®Œæ•´æ€§
}
```

#### 2. é˜…è¯»è¡Œä¸ºåˆ†æï¼ˆæ–°å¢ï¼‰
```typescript
behaviorStats: {
    averageReadingSpeed: number;      // å¹³å‡é€Ÿåº¦
    speedHistory: SpeedDataPoint[];   // âœ¨ é€Ÿåº¦æ›²çº¿
    jumpEvents: JumpEvent[];          // âœ¨ è·³è¯»æ£€æµ‹
    rereadStats: RereadStats;         // âœ¨ é‡è¯»ç»Ÿè®¡
    pauseResumeCount: number;         // âœ¨ æš‚åœæ¬¡æ•°
    continuousReadingTime: number;    // âœ¨ æœ€é•¿è¿ç»­æ—¶é•¿
}
```

#### 3. è¿›åº¦è¿½è¸ªï¼ˆæ–°å¢ï¼‰
```typescript
progressTracking: {
    currentProgress: number;          // å½“å‰ç™¾åˆ†æ¯”
    progressHistory: ProgressDataPoint[];  // âœ¨ è¿›åº¦æ›²çº¿
    completedChapters: number[];      // âœ¨ å·²å®Œæˆç« èŠ‚
    bookmarkedChapters: number[];     // âœ¨ ä¹¦ç­¾ç« èŠ‚
    lastChapterId: number;            // æœ€åç« èŠ‚
}
```

#### 4. æ—¶é—´åˆ†æï¼ˆå¢å¼ºï¼‰
```typescript
timeAnalysis: {
    hourlyDistribution: number[24];   // âœ¨ 24å°æ—¶åˆ†å¸ƒ
    weekdayDistribution: number[7];   // âœ¨ æ˜ŸæœŸåˆ†å¸ƒ
    preferredTimeSlot: TimeSlot;      // âœ¨ åå¥½æ—¶æ®µ
    dailyStats: {...};                // âœ… å¢å¼ºç‰ˆæ¯æ—¥ç»Ÿè®¡
    monthlyStats: {...};              // âœ¨ æœˆåº¦èšåˆ
}
```

#### 5. ç« èŠ‚ç»Ÿè®¡ï¼ˆå¢å¼ºï¼‰
```typescript
chapterStats: {
    [chapterId]: {
        timeSpent: number;            // âœ… ä¿ç•™
        readCount: number;            // âœ… ä¿ç•™
        lastRead: number;             // âœ… ä¿ç•™
        firstRead: number;            // âœ¨ æ–°å¢
        averageSpeed: number;         // âœ¨ æ–°å¢
        peakSpeed: number;            // âœ¨ æ–°å¢
        notesCount: number;           // âœ¨ æ–°å¢
        bookmarked: boolean;          // âœ¨ æ–°å¢
        difficulty: ChapterDifficulty; // âœ¨ æ–°å¢
    }
}
```

#### 6. æˆå°±ç³»ç»Ÿï¼ˆæ–°å¢ï¼‰
```typescript
achievements: {
    milestonesReached: string[];      // âœ¨ è¾¾æˆçš„æˆå°±
    streakRecords: {...};             // âœ¨ è¿ç»­é˜…è¯»è®°å½•
    speedRecords: {...};              // âœ¨ é€Ÿåº¦è®°å½•
    timeRecords: {...};               // âœ¨ æ—¶é•¿è®°å½•
}
```

### å…¨å±€ç»Ÿè®¡å¢å¼º

```typescript
interface EnhancedGlobalStats {
    library: {
        totalBooks, booksCompleted, booksInProgress,
        booksByType, booksByStatus
    };
    timeStats: {
        totalReadingTime, thisYear, thisMonth,
        thisWeek, today, averageDaily, longestSession
    };
    readingHabits: {
        preferredTimeSlot, mostProductiveDay,
        averageSessionLength, readingPeakHours
    };
    streaks: {
        currentStreak, longestStreak, streakHistory
    };
    rankings: {
        mostReadBooks, fastestBooks, recentBooks
    };
    yearlyGoals: {...};
    globalAchievements: {...};
}
```

---

## å®æ–½è®¡åˆ’

### é˜¶æ®µ1ï¼šåŸºç¡€è®¾æ–½æ­å»ºï¼ˆâœ… å·²å®Œæˆï¼‰

**æ—¶é—´**: 1-2å¤©

- [x] åˆ›å»ºå¢å¼ºæ•°æ®ç±»å‹ (`enhanced-stats.ts`)
- [x] å®ç°è·¯å¾„ç®¡ç†å·¥å…· (`stats-paths.ts`)
- [x] å®ç°æ•°æ®æ ¡éªŒå·¥å…· (`stats-validator.ts`)
- [x] å®ç°å¤šæ–‡ä»¶å­˜å‚¨æœåŠ¡ (`multi-file-stats-storage.ts`)
- [x] å®ç°å…¼å®¹é€‚é…å™¨ (`stats-adapter.ts`)
- [x] æ›´æ–°Settingsé…ç½®

**éªŒè¯æ ‡å‡†ï¼š**
- âœ… æ‰€æœ‰TypeScriptç±»å‹æ— é”™è¯¯
- âœ… åŸºç¡€æ–‡ä»¶è¯»å†™åŠŸèƒ½æ­£å¸¸
- âœ… æ•°æ®æ ¡éªŒåŠŸèƒ½æµ‹è¯•é€šè¿‡

### é˜¶æ®µ2ï¼šæ•°æ®è¿ç§»å·¥å…·ï¼ˆğŸ”„ è¿›è¡Œä¸­ï¼‰

**æ—¶é—´**: 1å¤©

- [ ] åˆ›å»ºè¿ç§»æœåŠ¡ (`stats-migration.ts`)
- [ ] å®ç°Loki â†’ å¤šæ–‡ä»¶è½¬æ¢
- [ ] å®ç°æ•°æ®å®Œæ•´æ€§éªŒè¯
- [ ] åˆ›å»ºè¿ç§»UIç•Œé¢
- [ ] æ·»åŠ è¿ç§»è¿›åº¦æ˜¾ç¤º
- [ ] å®ç°å›æ»šæœºåˆ¶

**éªŒè¯æ ‡å‡†ï¼š**
- è¿ç§»100æœ¬ä¹¦æ•°æ® < 30ç§’
- æ•°æ®å®Œæ•´æ€§100%éªŒè¯é€šè¿‡
- æ”¯æŒä¸­æ–­æ¢å¤
- å®Œæ•´çš„é”™è¯¯æ—¥å¿—

### é˜¶æ®µ3ï¼šé›†æˆåˆ°æ’ä»¶ï¼ˆå¾…å¼€å§‹ï¼‰

**æ—¶é—´**: 1-2å¤©

- [ ] æ›´æ–°main.tsé›†æˆé€‚é…å™¨
- [ ] ä¿®æ”¹é˜…è¯»å™¨ç»„ä»¶ä½¿ç”¨æ–°API
- [ ] æ·»åŠ è®¾ç½®é¡µé¢é€‰é¡¹
- [ ] å®ç°è¿ç§»å‘å¯¼
- [ ] æ›´æ–°æ–‡æ¡£

**éªŒè¯æ ‡å‡†ï¼š**
- ç°æœ‰åŠŸèƒ½100%æ­£å¸¸
- æ–°ç»Ÿè®¡åŠŸèƒ½å¯ç”¨
- åŒå†™æ¨¡å¼ç¨³å®šè¿è¡Œ

### é˜¶æ®µ4ï¼šUIå¢å¼ºï¼ˆå¾…å¼€å§‹ï¼‰

**æ—¶é—´**: 3-5å¤©

- [ ] è®¾è®¡ä¼ä¸šçº§ä»ªè¡¨æ¿
- [ ] å®ç°å¯è§†åŒ–å›¾è¡¨ï¼ˆECharts/Chart.jsï¼‰
- [ ] æ·»åŠ å¤šç»´åº¦ç­›é€‰
- [ ] å®ç°å¯¼å‡ºåŠŸèƒ½ï¼ˆJSON/CSV/Markdownï¼‰
- [ ] æ·»åŠ æˆå°±ç³»ç»ŸUI

### é˜¶æ®µ5ï¼šæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆå¾…å¼€å§‹ï¼‰

**æ—¶é—´**: 2-3å¤©

- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] ç”¨æˆ·éªŒæ”¶æµ‹è¯•
- [ ] Bugä¿®å¤

---

## é£é™©è¯„ä¼°

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| **æ•°æ®ä¸¢å¤±** | ğŸŸ¡ ä¸­ | ğŸ”´ é«˜ | å¼ºåˆ¶å¤‡ä»½ï¼Œæ•°æ®æ ¡éªŒï¼Œå›æ»šæœºåˆ¶ |
| **è¿ç§»å¤±è´¥** | ğŸŸ¡ ä¸­ | ğŸŸ  ä¸­ | åˆ†æ‰¹è¿ç§»ï¼Œä¸­æ–­æ¢å¤ï¼Œé”™è¯¯æ—¥å¿— |
| **æ€§èƒ½ä¸‹é™** | ğŸŸ¢ ä½ | ğŸŸ¡ ä¸­ | æ€§èƒ½æµ‹è¯•ï¼ŒæŒ‰éœ€åŠ è½½ï¼Œç´¢å¼•ä¼˜åŒ– |
| **å…¼å®¹æ€§é—®é¢˜** | ğŸŸ¢ ä½ | ğŸŸ  ä¸­ | å……åˆ†æµ‹è¯•ï¼ŒåŒå†™æ¨¡å¼ï¼Œå›æ»šæ–¹æ¡ˆ |
| **æ–‡ä»¶ç³»ç»Ÿé™åˆ¶** | ğŸŸ¢ ä½ | ğŸŸ¡ ä¸­ | æ–‡ä»¶æ•°ç›‘æ§ï¼Œåˆå¹¶ç­–ç•¥ |

---

## æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•

```typescript
describe('StatsValidator', () => {
    test('should generate valid checksum', ...);
    test('should detect corrupted data', ...);
    test('should repair basic errors', ...);
});

describe('MultiFileStatsStorage', () => {
    test('should create novel stats', ...);
    test('should save and load correctly', ...);
    test('should handle concurrent writes', ...);
});
```

### é›†æˆæµ‹è¯•

- æµ‹è¯•æ–°æ—§ç³»ç»ŸåŒå†™ä¸€è‡´æ€§
- æµ‹è¯•æ•°æ®è¿ç§»å®Œæ•´æ€§
- æµ‹è¯•å¤‡ä»½æ¢å¤æµç¨‹
- æµ‹è¯•å¤§æ•°æ®é‡åœºæ™¯ï¼ˆ1000+æœ¬ä¹¦ï¼‰

### æ€§èƒ½æµ‹è¯•

| æ“ä½œ | ç›®æ ‡ | å½“å‰ | æ–°ç³»ç»Ÿ |
|------|------|------|--------|
| åˆå§‹åŒ–åŠ è½½ | <500ms | ~2s | ~150ms |
| å•æœ¬ä¹¦æŸ¥è¯¢ | <50ms | ~100ms | ~20ms |
| ä¿å­˜ç»Ÿè®¡ | <100ms | ~200ms | ~50ms |
| å…¨å±€ç»Ÿè®¡è®¡ç®— | <1s | N/A | ~500ms |

---

## å›æ»šæ–¹æ¡ˆ

### åœºæ™¯1ï¼šè¿ç§»å¤±è´¥

1. åœæ­¢è¿ç§»è¿›ç¨‹
2. ä»å¤‡ä»½æ¢å¤Lokiæ•°æ®åº“
3. ç¦ç”¨æ–°ç³»ç»Ÿï¼ˆ`useEnhancedStats: false`ï¼‰
4. è®°å½•é”™è¯¯æ—¥å¿—ä¾›åˆ†æ

### åœºæ™¯2ï¼šè¿è¡Œæ—¶æ•…éšœ

1. è‡ªåŠ¨fallbackåˆ°æ—§ç³»ç»Ÿ
2. è®°å½•é”™è¯¯æ—¥å¿—
3. é€šçŸ¥ç”¨æˆ·æ£€æŸ¥æ•°æ®
4. æä¾›æ‰‹åŠ¨ä¿®å¤å·¥å…·

### åœºæ™¯3ï¼šæ•°æ®æŸå

1. ä»æ¯æ—¥å¤‡ä»½æ¢å¤
2. éªŒè¯æ•°æ®å®Œæ•´æ€§
3. é‡æ–°ç”Ÿæˆchecksum
4. æ›´æ–°ç´¢å¼•æ–‡ä»¶

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ğŸš€ ç«‹å³æ‰§è¡Œï¼ˆå½“å‰ï¼‰

1. âœ… å®Œæˆæ•°æ®è¿ç§»å·¥å…·
2. â³ é›†æˆåˆ°main.ts
3. â³ æ·»åŠ è¿ç§»UI

### ğŸ“… è¿‘æœŸè®¡åˆ’ï¼ˆæœ¬å‘¨ï¼‰

1. å®Œæ•´æµ‹è¯•
2. æ€§èƒ½ä¼˜åŒ–
3. æ–‡æ¡£æ›´æ–°

### ğŸ¯ é•¿æœŸç›®æ ‡ï¼ˆä¸‹å‘¨ï¼‰

1. UIä»ªè¡¨æ¿
2. æˆå°±ç³»ç»Ÿ
3. æ•°æ®å¯¼å‡º

---

## é™„å½•

### A. é…ç½®é€‰é¡¹

```typescript
// æ’ä»¶è®¾ç½®
settings: {
    useEnhancedStats: true,        // å¯ç”¨æ–°ç³»ç»Ÿ
    dualWriteStats: true,          // åŒå†™æ¨¡å¼
    autoMigrateStats: false,       // ä¸è‡ªåŠ¨è¿ç§»
    backupBeforeMigration: true    // è¿ç§»å‰å¤‡ä»½
}
```

### B. APIå‚è€ƒ

```typescript
// è·å–ç»Ÿè®¡ï¼ˆå…¼å®¹APIï¼‰
adapter.getNovelStats(novelId): Promise<NovelReadingStats>

// è·å–å¢å¼ºç»Ÿè®¡ï¼ˆæ–°APIï¼‰
adapter.getEnhancedNovelStats(novelId): Promise<EnhancedNovelStats>

// è¿ç§»æ•°æ®
migration.migrateAll(): Promise<MigrationResult>
```

### C. æ–‡ä»¶è·¯å¾„æ˜ å°„

```
æ—§ç³»ç»Ÿ: reading-stats.json
æ–°ç³»ç»Ÿ:
  - index.json
  - global.json
  - novels/{id}/stats.json
  - novels/{id}/sessions-{YYYY-MM}.json
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2024-01-16
**ç»´æŠ¤è€…**: Claude AI
